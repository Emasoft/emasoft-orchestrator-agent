# Messaging Protocol Part 1: API and Schema Reference


## Contents

- [1.1 API Base URL and Endpoints](#11-api-base-url-and-endpoints)
  - [Base URL](#base-url)
  - [Available Endpoints](#available-endpoints)
- [1.2 Complete Message Object Schema](#12-complete-message-object-schema)
  - [Field Descriptions](#field-descriptions)
  - [Content Object Requirements](#content-object-requirements)
- [1.3 Priority Levels](#13-priority-levels)
  - [Priority Selection Guidelines](#priority-selection-guidelines)
- [Related Sections](#related-sections)

---

**Parent document**: [messaging-protocol.md](messaging-protocol.md)

---

## 1.1 API Base URL and Endpoints

### Base URL

```bash
${AIMAESTRO_API:-http://localhost:23000}/api
```

The `AIMAESTRO_API` environment variable defaults to `http://localhost:23000` if not set.

### Available Endpoints

| Endpoint | Method | Purpose |
|----------|--------|---------|
| `/messages` | POST | Send a message |
| `/messages` | GET | Retrieve messages |
| `/agents` | GET | List registered agents |
| `/agents/{id}` | GET | Get agent details |

---

## 1.2 Complete Message Object Schema

Every message in the AI Maestro system follows this schema:

```json
{
  "id": "uuid-auto-generated",
  "from": "sender-session-name",
  "to": "recipient-session-name",
  "subject": "Brief subject line",
  "priority": "low|normal|high|urgent",
  "timestamp": "2025-12-30T10:00:00Z",
  "read": false,
  "content": {
    "type": "message-type",
    "task_id": "GH-issue-number",
    "...additional-fields": "based-on-type"
  }
}
```

### Field Descriptions

| Field | Required | Description |
|-------|----------|-------------|
| `id` | Auto | UUID generated by server |
| `from` | Auto | Sender's session name (auto-filled) |
| `to` | YES | Recipient's full session name |
| `subject` | YES | Brief descriptive subject line |
| `priority` | NO | Priority level (defaults to `normal`) |
| `timestamp` | Auto | ISO 8601 timestamp (server-generated) |
| `read` | Auto | Whether recipient has read message |
| `content` | YES | Object with `type` field and message data |

### Content Object Requirements

The `content` field MUST be an object (not a string) containing at minimum:

```json
{
  "type": "message-type",
  "message": "The actual content"
}
```

**Common mistake**: Passing `content` as a string instead of an object will result in a 400 Bad Request error.

---

## 1.3 Priority Levels

| Level | Use Case | Expected Response |
|-------|----------|-------------------|
| `low` | FYI updates, non-blocking information | When convenient |
| `normal` | Standard tasks and requests | Within 2 hours |
| `high` | Important tasks requiring attention | Within 30 minutes |
| `urgent` | Blocking issues, security problems | Immediate |

### Priority Selection Guidelines

**Use `urgent` when**:
- Security vulnerability discovered
- Production system blocked
- Critical deadline at risk
- User explicitly requested immediate attention

**Use `high` when**:
- Task is on critical path
- Blocking other agents' work
- Time-sensitive but not emergency

**Use `normal` when**:
- Standard development tasks
- Regular status updates
- Non-blocking requests

**Use `low` when**:
- Informational updates
- Nice-to-have improvements
- Background maintenance tasks

---

## Related Sections

- [Part 2: Sending and Receiving](messaging-protocol-part2-send-receive.md) - How to use these endpoints
- [Part 3: Message Types](messaging-protocol-part3-message-types.md) - Specific content schemas for each type
