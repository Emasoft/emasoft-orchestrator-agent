# Base Toolchain Template

This template defines the REQUIRED structure for all language-specific toolchain templates.
The orchestrator compiles this with language-specific values before sending to remote agents.

---

## Template Variables

Variables are enclosed in `{{variable_name}}` and MUST be replaced by the orchestrator:

| Variable | Description | Example |
|----------|-------------|---------|
| `{{LANGUAGE}}` | Primary language | `rust`, `python`, `javascript` |
| `{{LANGUAGE_VERSION}}` | Language version | `1.75`, `3.12`, `20` |
| `{{PACKAGE_MANAGER}}` | Package manager | `cargo`, `uv`, `pnpm` |
| `{{PACKAGE_MANAGER_VERSION}}` | Package manager version | `1.0.0`, `0.4.0` |
| `{{FORMATTER}}` | Code formatter | `rustfmt`, `ruff`, `prettier` |
| `{{LINTER}}` | Linter tool | `clippy`, `ruff`, `eslint` |
| `{{TYPE_CHECKER}}` | Type checker (if applicable) | `mypy`, `tsc`, `-` |
| `{{TEST_RUNNER}}` | Test framework | `cargo test`, `pytest`, `vitest` |
| `{{BUILD_COMMAND}}` | Build command | `cargo build`, `uv build`, `pnpm build` |
| `{{PROJECT_NAME}}` | Project name | `xls-cross-platform` |
| `{{TASK_ID}}` | Current task ID | `GH-42` |

---

## Toolchain Definition Block

```yaml
# TOOLCHAIN DEFINITION - {{LANGUAGE}}
# Generated by atlas-orchestrator for task: {{TASK_ID}}
# Project: {{PROJECT_NAME}}
# Timestamp: {{TIMESTAMP}}

toolchain:
  language: {{LANGUAGE}}
  version: {{LANGUAGE_VERSION}}

  package_manager:
    name: {{PACKAGE_MANAGER}}
    version: {{PACKAGE_MANAGER_VERSION}}
    install_cmd: "{{PACKAGE_MANAGER_INSTALL_CMD}}"

  tools:
    formatter:
      name: {{FORMATTER}}
      cmd: "{{FORMATTER_CMD}}"
      config_file: "{{FORMATTER_CONFIG}}"
    linter:
      name: {{LINTER}}
      cmd: "{{LINTER_CMD}}"
      config_file: "{{LINTER_CONFIG}}"
    type_checker:
      name: {{TYPE_CHECKER}}
      cmd: "{{TYPE_CHECKER_CMD}}"
      config_file: "{{TYPE_CHECKER_CONFIG}}"
    test_runner:
      name: {{TEST_RUNNER}}
      cmd: "{{TEST_CMD}}"
      coverage_cmd: "{{COVERAGE_CMD}}"

  verification:
    all_tools_cmd: "{{VERIFY_ALL_CMD}}"
    expected_exit_code: 0
```

---

## ATLAS Pipeline Labels (MANDATORY)

All projects managed by ATLAS orchestrator MUST use these standardized labels:

### Issue Labels

| Label | Color | Description |
|-------|-------|-------------|
| `status:backlog` | `#EDEDED` | Not started |
| `status:in-progress` | `#0052CC` | Work in progress |
| `status:in-review` | `#FBCA04` | PR created, awaiting review |
| `status:blocked` | `#D93F0B` | Blocked by dependency |
| `status:done` | `#0E8A16` | Completed and merged |
| `type:feature` | `#1D76DB` | New feature |
| `type:bugfix` | `#D73A4A` | Bug fix |
| `type:refactor` | `#A2EEEF` | Code refactoring |
| `type:test` | `#BFD4F2` | Test additions |
| `type:docs` | `#0075CA` | Documentation |
| `type:chore` | `#FEF2C0` | Maintenance task |
| `priority:p0-critical` | `#B60205` | Must fix immediately |
| `priority:p1-high` | `#D93F0B` | High priority |
| `priority:p2-medium` | `#FBCA04` | Medium priority |
| `priority:p3-low` | `#C2E0C6` | Low priority |
| `platform:all` | `#5319E7` | All platforms |
| `platform:macos` | `#000000` | macOS specific |
| `platform:windows` | `#0078D7` | Windows specific |
| `platform:linux` | `#FCC624` | Linux specific |
| `needs-user-decision` | `#E99695` | Escalation required |

### Branch Naming Convention

```
feature/{{TASK_ID}}-description
fix/{{TASK_ID}}-description
refactor/{{TASK_ID}}-description
test/{{TASK_ID}}-description
docs/{{TASK_ID}}-description
chore/{{TASK_ID}}-description
release/v{{VERSION}}
hotfix/{{TASK_ID}}-description
```

### Commit Message Convention

```
type({{TASK_ID}}): description

[optional body]

[optional footer]
```

Types: `feat`, `fix`, `refactor`, `test`, `docs`, `chore`, `perf`, `ci`

---

## Environment Setup Script Template

```bash
#!/bin/bash
# {{LANGUAGE}} Toolchain Setup for {{PROJECT_NAME}}
# Task: {{TASK_ID}}
# Generated by atlas-orchestrator

set -e

RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m'

log_info() { echo -e "${GREEN}[INFO]${NC} $*"; }
log_warn() { echo -e "${YELLOW}[WARN]${NC} $*"; }
log_error() { echo -e "${RED}[ERROR]${NC} $*"; }

# ============================================================
# STEP 1: Verify Prerequisites
# ============================================================

check_prerequisite() {
  local cmd="$1"
  local install_hint="$2"
  if ! command -v "$cmd" &>/dev/null; then
    log_error "$cmd not found. Install with: $install_hint"
    return 1
  fi
  log_info "$cmd: $(command -v "$cmd")"
}

log_info "Checking prerequisites..."
{{PREREQUISITE_CHECKS}}

# ============================================================
# STEP 2: Install Language Runtime
# ============================================================

install_language() {
  log_info "Installing {{LANGUAGE}} {{LANGUAGE_VERSION}}..."
  {{LANGUAGE_INSTALL_CMD}}
}

if ! command -v {{LANGUAGE_CMD}} &>/dev/null; then
  install_language
fi

# Verify version
INSTALLED_VERSION=$({{LANGUAGE_VERSION_CMD}} 2>&1 | head -1)
log_info "{{LANGUAGE}} version: $INSTALLED_VERSION"

# ============================================================
# STEP 3: Install Package Manager
# ============================================================

install_package_manager() {
  log_info "Installing {{PACKAGE_MANAGER}}..."
  {{PACKAGE_MANAGER_INSTALL_CMD}}
}

if ! command -v {{PACKAGE_MANAGER}} &>/dev/null; then
  install_package_manager
fi

# ============================================================
# STEP 4: Install Development Tools
# ============================================================

log_info "Installing development tools..."
{{DEV_TOOLS_INSTALL_CMD}}

# ============================================================
# STEP 5: Verify Installation
# ============================================================

verify_toolchain() {
  local failed=0

  log_info "Verifying toolchain..."

  {{VERIFY_COMMANDS}}

  if [ $failed -gt 0 ]; then
    log_error "$failed tool(s) failed verification"
    exit 1
  fi

  log_info "All tools verified successfully!"
}

verify_toolchain

# ============================================================
# STEP 6: Project Configuration
# ============================================================

configure_project() {
  log_info "Configuring project..."

  # Create config files if they don't exist
  {{CONFIG_FILE_CREATION}}

  log_info "Project configured!"
}

configure_project

echo ""
log_info "=========================================="
log_info "Toolchain setup complete!"
log_info "Run verification: {{VERIFY_ALL_CMD}}"
log_info "=========================================="
```

---

## Verification Checklist

Before reporting toolchain ready, verify ALL of the following:

```markdown
## Toolchain Verification Checklist

### Language Runtime
- [ ] {{LANGUAGE}} installed: `{{LANGUAGE_VERSION_CMD}}`
- [ ] Version matches: {{LANGUAGE_VERSION}}

### Package Manager
- [ ] {{PACKAGE_MANAGER}} installed: `{{PACKAGE_MANAGER}} --version`
- [ ] Can install dependencies: `{{INSTALL_DEPS_CMD}}`

### Development Tools
- [ ] Formatter works: `{{FORMATTER_CMD}} --check` or similar
- [ ] Linter works: `{{LINTER_CMD}}`
- [ ] Type checker works: `{{TYPE_CHECKER_CMD}}` (if applicable)
- [ ] Tests run: `{{TEST_CMD}}`

### Project Configuration
- [ ] Config files exist: {{CONFIG_FILES_LIST}}
- [ ] Labels created in GitHub (if new repo)
- [ ] Branch protection enabled (if applicable)

### ATLAS Compliance
- [ ] Uses standardized labels (see above)
- [ ] Uses branch naming convention
- [ ] Uses commit message convention
- [ ] CI workflow uses correct action names
```

---

## Error Recovery

If toolchain setup fails:

| Error | Cause | Fix |
|-------|-------|-----|
| Command not found | Tool not in PATH | Source shell config: `source ~/.bashrc` |
| Permission denied | Missing execute permission | `chmod +x script.sh` |
| Version mismatch | Wrong version installed | Reinstall with version manager |
| Network error | Download failed | Retry or use offline cache |
| Config conflict | Existing config differs | Backup and regenerate |

---

## Cross-Platform Notes

### macOS
- Use `brew` for system tools
- Xcode Command Line Tools required for some languages
- ARM (Apple Silicon) vs Intel may need different binaries

### Linux
- Use distro package manager for system dependencies
- May need `sudo` for global installs
- Check glibc version for binary compatibility

### Windows
- Use `winget`, `scoop`, or `choco` for system tools
- May need Visual Studio Build Tools for compiled languages
- Use Git Bash or WSL for shell scripts

---

## Template Metadata

```yaml
template:
  name: BASE_TOOLCHAIN
  version: 1.0.0
  eoa_compatible: true
  requires:
    - git
    - curl
    - bash
  generates:
    - setup script
    - verification checklist
    - config files
```
