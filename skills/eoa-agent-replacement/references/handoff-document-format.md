# Handoff Document Format Reference

## Contents

- [3.1 Required Sections](#31-required-sections)
- [3.2 Task Detail Format](#32-task-detail-format)
- [3.3 Progress Documentation](#33-progress-documentation)
- [3.4 Communication History Format](#34-communication-history-format)
- [3.5 Next Steps Clarity Requirements](#35-next-steps-clarity-requirements)

---

## 3.1 Required Sections

Every replacement handoff document MUST contain these sections:

### Mandatory Sections

| Section | Purpose | Required Content |
|---------|---------|------------------|
| Handoff Metadata | Identify document | From, To, Timestamp, Reason |
| Task Context | What work was assigned | All tasks with full details |
| User Requirements | IMMUTABLE requirements | Exact user specifications |
| Current Progress | What's done/remaining | Checklist with percentages |
| Technical Context | Code and environment | Files, dependencies, build status |
| Communication History | Decisions made | Clarifications, approvals |
| Next Steps | What to do first | Prioritized action list |
| Verification Requirements | Confirm handoff | ACK and verification checklist |

### Section Order

Sections MUST appear in this order to ensure the new agent reads critical context first:

1. Handoff Metadata
2. RULE 14 Notice (User Requirements)
3. Task Context
4. Current Progress
5. Technical Context
6. Communication History
7. Blockers/Issues
8. Next Steps
9. Verification Requirements
10. Resources/References

---

## Template

```markdown
# Agent Replacement Handoff

## Handoff Metadata

| Field | Value |
|-------|-------|
| **From** | {{FAILED_AGENT_ID}} |
| **To** | {{REPLACEMENT_AGENT_ID}} |
| **Generated** | {{TIMESTAMP_ISO8601}} |
| **Generated By** | EOA (Orchestrator) |
| **Reason** | {{FAILURE_REASON}} |
| **Urgency** | {{URGENCY_LEVEL}} |
| **Handoff ID** | {{HANDOFF_UUID}} |

---

## RULE 14: USER REQUIREMENTS ARE IMMUTABLE

**The following requirements were specified by the user and CANNOT be changed:**

{{USER_REQUIREMENTS}}

**If you encounter issues implementing these requirements:**
1. STOP work immediately
2. Report the issue to the orchestrator
3. WAIT for user decision
4. NEVER implement alternatives without explicit user approval

---

## Task Context

### Assigned Tasks

{{TASK_LIST}}

### Task Details

#### Task 1: {{TASK_1_NAME}}

| Field | Value |
|-------|-------|
| **Task UUID** | {{TASK_1_UUID}} |
| **Module** | {{TASK_1_MODULE}} |
| **GitHub Issue** | #{{TASK_1_ISSUE}} |
| **Priority** | {{TASK_1_PRIORITY}} |
| **Deadline** | {{TASK_1_DEADLINE}} |
| **Status at Failure** | {{TASK_1_STATUS}} |

**Description:**
{{TASK_1_DESCRIPTION}}

**Acceptance Criteria:**
{{TASK_1_ACCEPTANCE_CRITERIA}}

---

## Current Progress

### Overall Progress: {{OVERALL_PERCENTAGE}}%

### Completed Steps

- [x] {{COMPLETED_STEP_1}}
- [x] {{COMPLETED_STEP_2}}

### In Progress

- [ ] {{IN_PROGRESS_STEP}} ({{IN_PROGRESS_PERCENTAGE}}%)

### Pending Steps

- [ ] {{PENDING_STEP_1}}
- [ ] {{PENDING_STEP_2}}

### Failed Agent's Last Status

**Last Poll Response ({{LAST_POLL_TIMESTAMP}}):**
> {{LAST_POLL_RESPONSE}}

---

## Technical Context

### Modified Files

| File | Status | Notes |
|------|--------|-------|
| {{FILE_1}} | {{STATUS_1}} | {{NOTES_1}} |

### Uncommitted Changes

{{HAS_UNCOMMITTED_CHANGES}}

{{#IF_UNCOMMITTED}}
**Patch file attached:** `uncommitted_work.patch`

Apply with: `git apply uncommitted_work.patch`

Review carefully before applying - may contain incomplete work.
{{/IF_UNCOMMITTED}}

### Git Branch

| Field | Value |
|-------|-------|
| **Branch Name** | {{BRANCH_NAME}} |
| **Commits Ahead of Main** | {{COMMITS_AHEAD}} |
| **Last Commit** | {{LAST_COMMIT_MESSAGE}} |
| **TDD Phase** | {{TDD_PHASE}} |

### Dependencies

{{DEPENDENCIES_LIST}}

### Build/Test Status

| Check | Last Result | Timestamp |
|-------|-------------|-----------|
| Build | {{BUILD_STATUS}} | {{BUILD_TIMESTAMP}} |
| Tests | {{TEST_STATUS}} | {{TEST_TIMESTAMP}} |
| Lint | {{LINT_STATUS}} | {{LINT_TIMESTAMP}} |

---

## Communication History

### Key Clarifications

| Date | Topic | Decision |
|------|-------|----------|
| {{DATE_1}} | {{TOPIC_1}} | {{DECISION_1}} |

### Full Clarification Details

#### {{CLARIFICATION_1_TOPIC}}

**Question from failed agent:**
> {{QUESTION_1}}

**Orchestrator response:**
> {{RESPONSE_1}}

---

## Blockers and Known Issues

### Active Blockers

{{#IF_BLOCKERS}}
| Blocker | Impact | Attempted Solutions |
|---------|--------|---------------------|
| {{BLOCKER_1}} | {{IMPACT_1}} | {{SOLUTIONS_1}} |
{{/IF_BLOCKERS}}

{{#IF_NO_BLOCKERS}}
No active blockers at time of failure.
{{/IF_NO_BLOCKERS}}

### Known Issues

{{KNOWN_ISSUES_LIST}}

---

## Next Steps

**Your first action should be:**

1. **ACKNOWLEDGE** this handoff via AI Maestro
2. **VERIFY** your environment matches the technical requirements
3. **READ** the user requirements (RULE 14) completely
4. **REVIEW** the modified files and understand current state
5. **CONTINUE** from: {{CONTINUATION_POINT}}

### Detailed Next Steps

{{NEXT_STEPS_DETAILED}}

---

## Verification Requirements

### Immediate Actions Required

- [ ] ACK handoff receipt to orchestrator
- [ ] Confirm environment setup complete
- [ ] Confirm understanding of user requirements
- [ ] Confirm understanding of current progress
- [ ] Report any gaps in context

### ACK Format

Reply with:
```
[ACK] Handoff {{HANDOFF_UUID}} received
Understanding: {{ONE_LINE_SUMMARY_OF_TASK}}
Starting from: {{CONTINUATION_POINT}}
Questions: {{LIST_ANY_QUESTIONS}}
```

---

## Resources

- **GitHub Issue**: {{GITHUB_ISSUE_URL}}
- **Design Documents**: {{DESIGN_DOCS_PATH}}
- **Previous Handoffs**: {{PREVIOUS_HANDOFFS}}
- **Test Results**: {{TEST_RESULTS_URL}}
- **CI/CD Logs**: {{CI_LOGS_URL}}

---

**Handoff Generated**: {{GENERATION_TIMESTAMP}}
**Orchestrator Session**: {{ORCHESTRATOR_SESSION}}
```

---

## 3.2 Task Detail Format

Each task in the handoff MUST include these details:

### Required Task Fields

| Field | Required | Description |
|-------|----------|-------------|
| Task UUID | Yes | Unique identifier for tracking |
| Module Name | Yes | What part of system |
| GitHub Issue | Yes | Link to issue |
| Priority | Yes | high/medium/low |
| Deadline | If set | When due |
| Status at Failure | Yes | Where agent stopped |
| Description | Yes | Full task description |
| Acceptance Criteria | Yes | How to verify completion |
| User Requirements | Yes | Immutable user specs |

### Task Status Values

| Status | Meaning | Next Action |
|--------|---------|-------------|
| `pending` | Not started | Begin from scratch |
| `pending_verification` | Assigned, not verified | Complete verification |
| `in_progress` | Work started | Continue from checkpoint |
| `blocked` | Cannot proceed | Resolve blocker first |
| `review` | Waiting for review | Address review feedback |

---

## 3.3 Progress Documentation

### Progress Checklist Format

Use explicit percentages and completion markers:

```markdown
### Progress: 60%

#### Completed (100%)
- [x] Set up project structure
- [x] Implement core authentication logic
- [x] Write unit tests for auth module

#### In Progress (75%)
- [ ] Token refresh implementation
  - [x] Refresh token generation
  - [x] Token storage
  - [ ] Expiration handling (in progress)
  - [ ] Refresh endpoint

#### Not Started (0%)
- [ ] Integration tests
- [ ] Documentation
- [ ] Error handling edge cases
```

### Last Known State

Always include the agent's last status report verbatim:

```markdown
### Last Status Report (2026-01-31T14:00:00Z)

> **Progress**: 60%
> **Current work**: Implementing token refresh expiration logic
> **Next step**: Complete expiration checks, then move to refresh endpoint
> **Issues**: None currently
> **Blockers**: None
```

---

## 3.4 Communication History Format

### Clarification Log Format

```markdown
### Clarification: JWT Algorithm Selection

**Date**: 2026-01-31T10:30:00Z
**Context**: Agent asked which algorithm to use for JWT signing

**Agent Question:**
> Should I use HS256 or RS256 for JWT signing? HS256 is simpler but RS256 provides better security for distributed systems.

**Orchestrator Response:**
> Use RS256 for all JWT signing. The user requires production-grade security and we have proper key management infrastructure.

**Decision**: Use RS256 algorithm
**Impact**: Agent must implement RSA key handling
```

### Decision Summary Table

Include a quick-reference table of all decisions:

```markdown
### Decision Summary

| Date | Topic | Decision | Impact |
|------|-------|----------|--------|
| 2026-01-31 | JWT Algorithm | RS256 | Implement RSA keys |
| 2026-01-31 | Token Expiry | 7 days | Longer refresh window |
| 2026-01-31 | Rate Limiting | Use Redis | Additional dependency |
```

---

## 3.5 Next Steps Clarity Requirements

### First Action MUST Be Unambiguous

The "Next Steps" section MUST tell the new agent EXACTLY what to do first:

**WRONG (vague):**
```markdown
## Next Steps
Continue working on the authentication module.
```

**CORRECT (specific):**
```markdown
## Next Steps

1. **FIRST ACTION**: Open `src/auth/tokens.py` line 142 and complete the `handle_expiration()` function
   - The function signature is already defined
   - Refer to the inline TODO comment for expected behavior
   - Tests for this function exist in `tests/test_auth.py::test_token_expiration`

2. After `handle_expiration()` is complete, implement the refresh endpoint in `src/api/auth.py`

3. Run `pytest tests/test_auth.py -v` to verify all auth tests pass
```

### Next Steps Checklist

Before finalizing handoff, verify next steps:

- [ ] First action specifies exact file and line number
- [ ] First action is completable without further clarification
- [ ] Success criteria for first action is clear
- [ ] No assumptions about what new agent knows
- [ ] Commands to run are explicit
- [ ] Expected outcomes are stated

---

**Version**: 1.0.0
**Last Updated**: 2026-02-02
